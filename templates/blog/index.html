{% extends "base.html" %}
{% load static %}

{% block title %}Blog — Bambicim{% endblock %}

{% block content %}
    <section class="b-container blog-index">
        <h1 class="h-xl">Blog</h1>

        {# Normalize the queryset name so we don't 500 if it's post_list/object_list/page_obj #}
        {% with
        _items=posts|default:post_list|default:object_list
        %}
        {% if not _items and page_obj %}
            {% with _items=page_obj.object_list %}
            {% endwith %}
        {% endif %}

        <div class="grid posts-grid">
            {% for p in _items %}
                <article class="card post-card">
                    <a href="{{ p.get_absolute_url }}" class="post-cover">
                        {% if p.cover_image %}
                            {# Use relative /media/... here to avoid needing request in the context #}
                            <img
                                    src="{{ p.cover_image.url }}"
                                    alt="{{ p.title }}"
                                    loading="lazy">
                        {% endif %}
                    </a>

                    <div class="post-body">
                        <h2 class="h-lg"><a href="{{ p.get_absolute_url }}">{{ p.title }}</a></h2>
                        <p class="muted">{{ p.publish_at|date:"M d, Y" }} · {{ p.reading_time }} min read</p>
                        <p>{{ p.excerpt|default:p.seo_description|default:p.title }}</p>
                        <a class="btn" href="{{ p.get_absolute_url }}">Read</a>
                    </div>
                </article>
            {% empty %}
                <p class="empty muted">No posts yet.</p>
            {% endfor %}
        </div>
        {% endwith %}
    </section>
{% endblock %}
