{% extends "base.html" %}
{% load static blog_extras %}

{% block title %}Blog — Bambicim{% endblock %}

{% block content %}
    <section class="b-container blog-index">
        <h1 class="h-xl">Bambicim Blog</h1>

        {% with items=posts|default:object_list %}
            {% if not items and page_obj %}{% with items=page_obj.object_list %}{% endwith %}{% endif %}

            <div class="grid posts-grid">
                {% for p in items %}
                    <article class="card post-card {% if p.featured %}is-featured-pink{% endif %}">
                        <a href="{{ p.get_absolute_url }}" class="post-cover">
                            {% if p.cover_image %}
                                {% with abs=p.cover_image.url|build_absolute_uri %}
                                    <img src="{{ abs }}" alt="{{ p.title }}" loading="lazy">
                                    <script>
                                        console.group("[Index] post #{{ p.id }}");
                                        console.log("name:", "{{ p.cover_image.name|escapejs }}");
                                        console.log("url:", "{{ p.cover_image.url|escapejs }}");
                                        console.log("abs:", "{{ abs|escapejs }}");
                                        console.groupEnd();
                                    </script>
                                {% endwith %}
                            {% else %}
                                <script>console.warn("[Index] post #{{ p.id }} has no cover_image");</script>
                            {% endif %}
                        </a>

                        <div class="post-body">
                            {% if p.category %}
                                <p class="muted category-link"><a
                                        href="{% url 'blog:category' p.category.slug %}">{{ p.category.name }}</a></p>
                            {% endif %}
                            <h2 class="h-lg"><a href="{{ p.get_absolute_url }}">{{ p.title }}</a></h2>
                            <p class="muted post-meta">{{ p.publish_at|date:"M d, Y" }} · {{ p.reading_time }} min
                                read</p>
                            <p class="excerpt">{{ p.excerpt|default:p.seo_description|default:p.title }}</p>
                            <a class="btn {% if p.featured %}btn-pink-outline{% endif %}"
                               href="{{ p.get_absolute_url }}">Read Article</a>
                        </div>
                    </article>
                {% empty %}
                    <p class="empty muted">No posts yet.</p>
                {% endfor %}
            </div>
        {% endwith %}
    </section>
{% endblock %}
